# ê°€ìƒë“œë¡  ì†¡ìˆ˜ì‹  í”„ë¡œê·¸ë¨
> **ë“œë¡  ì¹´ë©”ë¼ ì—­í• ì„ í•˜ëŠ” â€œê°€ìƒì˜ ì˜ìƒ ì†¡ì‹  í”„ë¡œê·¸ë¨
> ì‹¤ì œ ë“œë¡  ëŒ€ì‹ , ì´ í”„ë¡œê·¸ë¨ì´ **ì˜ìƒ íŒŒì¼ì´ë‚˜ ì›¹ìº ì„ ì½ì–´ì„œ ë„¤íŠ¸ì›Œí¬ë¡œ ì†¡ì¶œ**í•˜ê³ ,  
> ë‹¤ë¥¸ ìª½ì—ì„œ ê·¸ê±¸ ë°›ì•„ì„œ ë³´ëŠ” êµ¬ì¡°ì•¼.

---

## ğŸ§© êµ¬ì¡° ê°œìš”

- **Sender (ë“œë¡  ì—­í• )**  
  - ë™ì˜ìƒ íŒŒì¼ ë˜ëŠ” ì›¹ìº ì—ì„œ í”„ë ˆì„ ì½ê¸°  
  - í”„ë ˆì„ì„ JPEGë¡œ ì••ì¶•  
  - TCP ì†Œì¼“ìœ¼ë¡œ ì „ì†¡

- **Receiver (ì§€ìƒ ê´€ì œ ì—­í• )**  
  - TCPë¡œ í”„ë ˆì„ ìˆ˜ì‹   
  - ë””ì½”ë”© í›„ í™”ë©´ì— í‘œì‹œ  
  - ë‚˜ì¤‘ì— YOLO ë¶„ì„ ì½”ë“œ ë¶™ì´ê¸° ê°€ëŠ¥

---

## 1ï¸âƒ£ Sender: ê°€ìƒì˜ ë“œë¡  ì¹´ë©”ë¼ ì†¡ì‹  í”„ë¡œê·¸ë¨

```python
# sender.py
import cv2
import socket
import struct

def main():
    # 0ì´ë©´ ì›¹ìº , "video.mp4"ë©´ ë™ì˜ìƒ íŒŒì¼
    source = "cctv_sample.mp4"
    cap = cv2.VideoCapture(source)

    # ì†¡ì‹ í•  ì„œë²„(=ìˆ˜ì‹  í”„ë¡œê·¸ë¨ì´ ê¸°ë‹¤ë¦¬ëŠ” ê³³)
    host = "127.0.0.1"
    port = 5000

    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((host, port))
    print(f"[Sender] Connected to {host}:{port}")

    try:
        while True:
            ret, frame = cap.read()
            if not ret:
                print("[Sender] No more frames. Exiting.")
                break

            # JPEGë¡œ ì••ì¶•
            encode_param = [int(cv2.IMWRITE_JPEG_QUALITY), 80]
            result, encimg = cv2.imencode(".jpg", frame, encode_param)
            data = encimg.tobytes()

            # ë¨¼ì € ê¸¸ì´(4ë°”ì´íŠ¸) ì „ì†¡ í›„, ì‹¤ì œ ë°ì´í„° ì „ì†¡
            sock.sendall(struct.pack(">I", len(data)) + data)

            # ì†¡ì‹  ì¤‘ì¸ í™”ë©´ ë¡œì»¬ì—ì„œë„ í™•ì¸
            cv2.imshow("Sender - Drone Camera", frame)
            if cv2.waitKey(1) == 27:  # ESC
                break
    finally:
        cap.release()
        sock.close()
        cv2.destroyAllWindows()
        print("[Sender] Closed.")

if __name__ == "__main__":
    main()
```

---

## 2ï¸âƒ£ Receiver: ì§€ìƒì—ì„œ ë“œë¡  ì˜ìƒì„ ë°›ëŠ” í”„ë¡œê·¸ë¨

```python
# receiver.py
import cv2
import socket
import struct
import numpy as np

def main():
    host = "0.0.0.0"
    port = 5000

    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.bind((host, port))
    sock.listen(1)
    print(f"[Receiver] Listening on {host}:{port}...")

    conn, addr = sock.accept()
    print(f"[Receiver] Connected by {addr}")

    data_buffer = b""

    try:
        while True:
            # ë¨¼ì € 4ë°”ì´íŠ¸ ê¸¸ì´ ì •ë³´ ë°›ê¸°
            while len(data_buffer) < 4:
                packet = conn.recv(4096)
                if not packet:
                    print("[Receiver] Connection closed.")
                    return
                data_buffer += packet

            msg_len = struct.unpack(">I", data_buffer[:4])[0]
            data_buffer = data_buffer[4:]

            # ì§€ì •ëœ ê¸¸ì´ë§Œí¼ í”„ë ˆì„ ë°ì´í„° ìˆ˜ì‹ 
            while len(data_buffer) < msg_len:
                packet = conn.recv(4096)
                if not packet:
                    print("[Receiver] Connection closed.")
                    return
                data_buffer += packet

            frame_data = data_buffer[:msg_len]
            data_buffer = data_buffer[msg_len:]

            # JPEG ë””ì½”ë”©
            nparr = np.frombuffer(frame_data, np.uint8)
            frame = cv2.imdecode(nparr, cv2.IMREAD_COLOR)

            if frame is None:
                print("[Receiver] Failed to decode frame.")
                continue

            cv2.imshow("Receiver - Ground Station", frame)
            if cv2.waitKey(1) == 27:  # ESC
                break
    finally:
        conn.close()
        sock.close()
        cv2.destroyAllWindows()
        print("[Receiver] Closed.")

if __name__ == "__main__":
    main()
```

---

## 3ï¸âƒ£ ì‹¤í–‰ ìˆœì„œ

1. **ë¨¼ì € ìˆ˜ì‹  í”„ë¡œê·¸ë¨ ì‹¤í–‰**

```bash
python receiver.py
```

2. **ê·¸ ë‹¤ìŒ ì†¡ì‹  í”„ë¡œê·¸ë¨ ì‹¤í–‰**

```bash
python sender.py
```

ê·¸ëŸ¬ë©´:

- `sender.py`ê°€ **ë“œë¡  ì¹´ë©”ë¼ ì—­í• **ë¡œ ì˜ìƒ í”„ë ˆì„ì„ ë„¤íŠ¸ì›Œí¬ë¡œ ë³´ë‚´ê³   
- `receiver.py`ê°€ **ì§€ìƒ ê´€ì œ ì—­í• **ë¡œ ê·¸ ì˜ìƒì„ ë°›ì•„ì„œ í™”ë©´ì— ë„ì›Œì¤˜.

---

## 4ï¸âƒ£ ì—¬ê¸°ì„œë¶€í„° í™•ì¥í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤

- Receiver ìª½ì— **YOLO ë¶„ì„ ì½”ë“œ** ë¶™ì´ê¸°  
- ì—¬ëŸ¬ Sender(ë“œë¡ ) â†’ í•˜ë‚˜ì˜ Receiver(ê´€ì œ) êµ¬ì¡°  
- ì†¡ì‹  ìª½ì—ì„œ **í•´ìƒë„/í”„ë ˆì„ë ˆì´íŠ¸ ì¡°ì ˆ**  
- RTSP/RTMP/WebRTC ê°™ì€ ì‹¤ì œ ìŠ¤íŠ¸ë¦¬ë° í”„ë¡œí† ì½œë¡œ í™•ì¥  
