# TCP 영상 송수신 상세
---

# 🎥 기본 전제

영상 1장을 이렇게 보내는 상황입니다:

```
[영상 길이 4바이트] + [JPEG 인코딩된 영상 데이터]
```

예를 들어:

* 영상 데이터 크기 = 10,000 바이트라면
* 실제 전송되는 구조는:

```
[00 00 27 10] + [10,000 bytes]
```

---

# 🖥 1️⃣ 송신 측 (Server)에서 보는 모습

### 내부 메모리 구조

```
┌────────────────────────────────────┐
│ 00 00 27 10 │ FF D8 FF E0 ...     │
│ (4바이트)   │ (영상 데이터 10000B) │
└────────────────────────────────────┘
```

이걸 `send()`로 보냅니다.

---

# 🌐 2️⃣ TCP 내부에서 실제로는 이렇게 쪼개짐

중요 ⭐

TCP는 이 데이터를 마음대로 나눠서 보냅니다.

예:

```
패킷1: 00 00
패킷2: 27 10 FF D8 FF
패킷3: E0 ....
패킷4: ....
```

💡 송신자가 1번에 보냈어도
수신자는 여러 번에 나눠 받습니다.

---

# 🖥 3️⃣ 수신 측에서 실제로 recv() 하면

### ❌ 초보자가 기대하는 모습

```
recv() → 10004바이트 한번에 도착
```

### ⛔ 실제 모습

```
recv(4)  → 00 00
recv(2)  → 27 10
recv(500) → FF D8 FF E0 ....
recv(3000)
recv(2000)
...
```

그래서 **recvall()이 필요한 것**입니다.

---

# 📦 전체 흐름 그림 (한 장의 영상)

```
송신측(Server)                          수신측(Client)
────────────────────────────────────────────────────────

1️⃣ 영상 생성
   frame

2️⃣ JPEG 인코딩
   ↓
   image_bytes (10000B)

3️⃣ 길이 계산
   len = 10000

4️⃣ 전송 데이터 구성
   ┌──────────────┬────────────────────┐
   │ 4바이트 길이 │ 영상데이터 10000B  │
   └──────────────┴────────────────────┘

5️⃣ send() ─────────────────────────────▶

                                  6️⃣ recvall(4)
                                     → 길이 확보

                                  7️⃣ recvall(10000)
                                     → 영상 데이터 확보

                                  8️⃣ numpy 변환

                                  9️⃣ 화면 출력
```

---

# 🎯 패킷 단위 그림 (TCP 관점)

```
┌───────────────────────────────────────┐
│           TCP 스트림 구조              │
└───────────────────────────────────────┘

보낸 데이터:
[AAAA][BBBBBBBBBBBBBBBBBBBBBBBB]

TCP가 나눈 모습:
[AA]
[AA BB BB]
[BBBBBBBB]
[BBBBBBBB]
[BBBB]

수신측에서 보이는 모습:
recv() 할 때마다 랜덤하게 잘려서 옴
```

---

# 🔥 왜 길이를 먼저 보내야 할까?

TCP는 이런 식입니다:

```
AAAAAAAAAABBBBBBBBBBBBBCCCCCCCC
```

여기서

* A = 첫 번째 영상
* B = 두 번째 영상
* C = 세 번째 영상

경계가 없습니다 ❗

그래서 반드시 이렇게 만들어야 합니다:

```
[길이][데이터][길이][데이터][길이][데이터]
```

그래야 수신자가:

```
1️⃣ 길이 읽음
2️⃣ 그 길이만큼 읽음
3️⃣ 다시 길이 읽음
```

이 패턴으로 반복할 수 있습니다.

---

# 📊 영상 3장 연속 전송 그림

```
송신 메모리:

┌──────┬────────┬──────┬────────┬──────┬────────┐
│Len1  │Frame1  │Len2  │Frame2  │Len3  │Frame3  │
└──────┴────────┴──────┴────────┴──────┴────────┘


TCP 스트림:

Len1 Fra
me1Len2Fram
e2Len3Frame3


수신 처리:

[Len1] → Frame1
[Len2] → Frame2
[Len3] → Frame3
```

---

# 🧠 초보자가 꼭 이해해야 할 핵심

### ❌ TCP는 "패킷 기반"이 아니다

→ 경계가 없다

### ✅ TCP는 "바이트 스트림"이다

→ 그냥 긴 데이터 흐름

### 그래서 반드시

✔ 길이를 먼저 보내야 하고
✔ 정확히 그 길이만큼 반복 수신해야 한다

---

# 🎬 실제 영상 스트리밍 전체 구조

```
while True:

   송신측:
   [4바이트 길이][JPEG 프레임]

   ↓

   수신측:
   1. 4바이트 읽기
   2. 그 길이만큼 읽기
   3. 이미지 복원
   4. 화면 출력
```

어디까지 이해되셨는지 말해주시면 거기 맞춰서 더 쉽게 설명해 드릴게요 😊
